-- -*- mode: lua; coding: windows-1251-dos -*-
--
-- on_before_add() вызывается движком из CDangerManager::add() и
-- разрешает или запрещает добавлять этот danger.

function on_before_add( npc, mem_obj, pos, lvl_time, danger_type, perceive_type )
  local obj = mem_obj:object()
  if
    perceive_type == danger_object.sound
    and obj and ( obj:is_actor() or obj:is_custom_monster() )
    and npc:is_relation_enemy( obj )
  then
    return xrs_battle_ai.check_is_enemy( npc, obj )
  end
  return true
end
